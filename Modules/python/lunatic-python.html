<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="robots" content="index,nofollow">

<title>Lunatic Python - Labix</title>
<script type="text/javascript" src="/moin//common/js/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin//labixtheme/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="/moin//labixtheme/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="/moin//labixtheme/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="/moin//labixtheme/css/projection.css">

<!-- css only for MSIE browsers -->
<!--[if IE]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin//labixtheme/css/msie.css">
<![endif]-->

<link rel="alternate" title="Labix Blog" href="http://blog.labix.org/feed" type="application/rss+xml">

<link rel="Start" href="/MainPage">
<link rel="Alternate" title="Wiki Markup" href="/lunatic-python?action=raw">
<link rel="Alternate" media="print" title="Print View" href="/lunatic-python?action=print">
<link rel="Appendix" title="lunatic-python-1.0.tar.bz2" href="/lunatic-python?action=AttachFile&amp;do=view&amp;target=lunatic-python-1.0.tar.bz2">
<link rel="Search" href="/FindPage">
<link rel="Index" href="/TitleIndex">
<link rel="Glossary" href="/WordIndex">
<link rel="Help" href="/HelpOnFormatting">
</head>

<body  lang="en" dir="ltr">

<div id="header">

<form id="searchform" method="get" action="/lunatic-python">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput">Search:</label>
<input id="searchinput" type="text" name="value" value="" size="20"
    onfocus="searchFocus(this)" onblur="searchBlur(this)"
    onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search">
<input id="titlesearch" name="titlesearch" type="submit"
    value="Titles" alt="Search Titles">
<input id="fullsearch" name="fullsearch" type="submit"
    value="Text" alt="Search Full Text">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>

<div id="logo"><a href="/MainPage">Labix</a></div>
</div>

<div id="sidebar">
<div class="sidepanel">
<h1>Navigation</h1>

<ul id="navibar">
<li class="wikilink"><a href="/MainPage">Index</a></li><li class="wikilink"><a href="/RecentChanges">RecentChanges</a></li><li class="wikilink"><a href="/FindPage">FindPage</a></li><li class="wikilink"><a href="/HelpContents">HelpContents</a></li><li class="current"><a href="/lunatic-python">Lunatic Python</a></li>
</ul>

</div>

<div class="sidepanel">
<h1>User</h1>
<ul id="username"><li><a href="/lunatic-python?action=login" id="login" rel="nofollow">Login</a></li></ul>
</div>
</div>

<div id="page" lang="en" dir="ltr">

<div id="navigation">

</div>
<h1 id="title">Lunatic Python</h1><div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li><a href="#head-c625d7c13475cdbf686b2bfb3f579beefd183969">Introduction</a></li><li><a href="#head-29cc79f915f76c41ba7884295e04d8724fee0f3d">Why?</a></li><li><a href="#head-1287b0fad0175e2b4da800c4ebe0e10ab47d1e22">Examples</a><ol><li><a href="#head-754f1a340baa86da36ce0edb8ff8cb396d5be73f">Lua inside Python</a></li><li><a href="#head-f85d4ac1416491b93f8d7dbd118101ccb750b88f">Python inside Lua</a></li></ol><li><a href="#head-2b1074a43c064d4256fdb634f290e18dfd10d68c">Documentation</a><ol><li><a href="#head-36c779da319d8576b21bbfcd186cab10c9ad8b80">Theory</a></li><li><a href="#head-67ce9242ddc55aba62a220e6db72d6d64dd18998">Attribute vs. Subscript object access</a></li><li><a href="#head-754f1a340baa86da36ce0edb8ff8cb396d5be73f-2">Lua inside Python</a><ol><li><a href="#head-d29353f5a33d5df95da35c5537c583b3ff2f4720">lua.execute(statement)</a></li><li><a href="#head-d934c4a2e4b687ab256d526d1a3a1a4c089a6e03">lua.eval(expression)</a></li><li><a href="#head-ac48999ec279de50c49eee315e9df5d6bc2879ef">lua.globals()</a></li><li><a href="#head-0264b4d4fce62e6c897a0947f34107d5484f67cc">lua.require(name)</a></li></ol><li><a href="#head-f85d4ac1416491b93f8d7dbd118101ccb750b88f-2">Python inside Lua</a><ol><li><a href="#head-34c7190d9f029d0c2164b8c935ea07674ad2047d">python.execute(statement)</a></li><li><a href="#head-5653b4cdbfb4fad708dec62eedd259df979fc974">python.eval(expression)</a></li><li><a href="#head-5d0bf28f2f609cc7c1b68a665e05ea67c5e73c38">python.globals()</a></li><li><a href="#head-5efd9b09e3d66ddbdb8bd240165be18356872357">python.locals()</a></li><li><a href="#head-7e8be30dff3be73fecf2de0e70c9f4ddba3049cf">python.builtins()</a></li><li><a href="#head-ab520505e27022fc9bebe849aa257d31d2314696">python.import(name)</a></li><li><a href="#head-b593adbfa6879b3a8579b9d17d9446cf9a493a6b">python.asattr(pyobj)</a></li><li><a href="#head-20f9d5f61fe1e5789c62458c1d0619164d21beac">python.asindx(pyobj)</a></li><li><a href="#head-eeecbb742a965bf4acc375f09e99dd18917abe35">python.asfunc(pyobj)</a></li></ol></li></ol><li><a href="#head-19c09b3ae3308b28c62a9ba29b931cf33ec79584">License</a></li><li><a href="#head-ab5161ec0e130f46c66e3a207a80e8e4893b3b21">Download</a></li><li><a href="#head-d0597456187b5ea4006f9427346633f765432975">Author</a></li></ol></div> <span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line867">
<h2 id="head-c625d7c13475cdbf686b2bfb3f579beefd183969">Introduction</h2>
<span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><p class="line867"><strong>Lunatic Python</strong> is a two-way bridge between <span class="anchor" id="line-8"></span><a class="http" href="http://www.python.org">Python</a> and <a class="http" href="http://www.lua.org">Lua</a>, allowing <span class="anchor" id="line-9"></span>these languages to intercommunicate. Being two-way means that it allows <span class="anchor" id="line-10"></span>Lua inside Python, Python inside Lua, Lua inside Python inside Lua, <span class="anchor" id="line-11"></span>Python inside Lua inside Python, and so on. <span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><span class="anchor" id="line-14"></span><p class="line867">
<h2 id="head-29cc79f915f76c41ba7884295e04d8724fee0f3d">Why?</h2>
<span class="anchor" id="line-15"></span><span class="anchor" id="line-16"></span><p class="line874">Even though the project was born as an experiment, it's already <span class="anchor" id="line-17"></span>being used in real world projects to integrate features from both <span class="anchor" id="line-18"></span>languages. <span class="anchor" id="line-19"></span><span class="anchor" id="line-20"></span><p class="line874">Please, let me know if you use it in real world projects. <span class="anchor" id="line-21"></span><span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><p class="line867">
<h2 id="head-1287b0fad0175e2b4da800c4ebe0e10ab47d1e22">Examples</h2>
<span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span><p class="line867">
<h3 id="head-754f1a340baa86da36ce0edb8ff8cb396d5be73f">Lua inside Python</h3>
<span class="anchor" id="line-27"></span><span class="anchor" id="line-28"></span><p class="line874">A basic example. <span class="anchor" id="line-29"></span><span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><span class="anchor" id="line-38"></span><pre>&gt;&gt;&gt; import lua
&gt;&gt;&gt; lg = lua.globals()
&gt;&gt;&gt; lg.string
&lt;Lua table at 0x81c6a10&gt;
&gt;&gt;&gt; lg.string.lower
&lt;Lua function at 0x81c6b30&gt;
&gt;&gt;&gt; lg.string.lower("Hello world!")
'hello world!'</pre><span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><p class="line874">Now, let's put a local object into Lua space. <span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><pre>&gt;&gt;&gt; d = {}
&gt;&gt;&gt; lg.d = d
&gt;&gt;&gt; lua.execute("d['key'] = 'value'")
&gt;&gt;&gt; d
{'key': 'value'}</pre><span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><p class="line874">Can we get the reference back from Lua space? <span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span><pre>&gt;&gt;&gt; d2 = lua.eval("d")
&gt;&gt;&gt; d is d2
True</pre><span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><p class="line874">Good! Is the python interface available inside the Lua interpreter? <span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><pre>&gt;&gt;&gt; lua.eval("python")
&lt;Lua table at 0x81c7540&gt;</pre><span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><p class="line874">Yes, it looks so. Let's nest some evaluations and see a local reference <span class="anchor" id="line-63"></span>passing through. <span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span><pre>&gt;&gt;&gt; class MyClass: pass
...
&gt;&gt;&gt; obj = MyClass()
&gt;&gt;&gt; obj
&lt;__main__.MyClass instance at 0x403ccb4c&gt;
&gt;&gt;&gt; lua.eval(r"python.eval('lua.eval(\"python.eval(\'obj\')\")')")
&lt;__main__.MyClass instance at 0x403ccb4c&gt;</pre><span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span><p class="line862">Are you still following me? <img alt=":)" height="15" src="/moin//labixtheme/img/smile.png" title=":)" width="15" />  Good. Then you've probably noticed that <span class="anchor" id="line-75"></span>the Python interpreter state inside the Lua interpreter state is the <span class="anchor" id="line-76"></span>same as the outside Python we're running. Let's see that in a more <span class="anchor" id="line-77"></span>comfortable way. <span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><pre>&gt;&gt;&gt; lua.execute("pg = python.globals()")
&gt;&gt;&gt; lua.eval("pg.obj")
&lt;__main__.MyClass instance at 0x403ccb4c&gt;</pre><span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><p class="line874">Things get more interesting when we start to really mix Lua and <span class="anchor" id="line-85"></span>Python code. <span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span><span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span><pre>&gt;&gt;&gt; table = lua.eval("table")
&gt;&gt;&gt; def show(key, value):
...   print "key is %s and value is %s" % (`key`, `value`)
...
&gt;&gt;&gt; t = lua.eval("{a=1, b=2, c=3}")
&gt;&gt;&gt; table.foreach(t, show)
key is 'a' and value is 1
key is 'c' and value is 3
key is 'b' and value is 2
&gt;&gt;&gt; </pre><span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span><p class="line874">Of course, in this case the same could be achieved easily <span class="anchor" id="line-100"></span>with Python. <span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span><span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><pre>&gt;&gt;&gt; def show(key, value):
...   print "key is %s and value is %s" % (`key`, `value`)
...
&gt;&gt;&gt; t = lua.eval("{a=1, b=2, c=3}")
&gt;&gt;&gt; for k in t:
...   show(k, t[k])
...
key is 'a' and value is 1
key is 'c' and value is 3
key is 'b' and value is 2</pre><span class="anchor" id="line-113"></span><span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><p class="line867">
<h3 id="head-f85d4ac1416491b93f8d7dbd118101ccb750b88f">Python inside Lua</h3>
<span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><p class="line874">Now, let's have a look from another perspective. The basic idea <span class="anchor" id="line-118"></span>is exactly the same. <span class="anchor" id="line-119"></span><span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span><span class="anchor" id="line-125"></span><span class="anchor" id="line-126"></span><span class="anchor" id="line-127"></span><pre>&gt; require("python")
&gt; python.execute("import string")
&gt; pg = python.globals()
&gt; =pg.string
&lt;module 'string' from '/usr/lib/python2.3/string.pyc'&gt;
&gt; =pg.string.lower("Hello world!")
hello world!</pre><span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span><p class="line862">As Lua is mainly an embedding language, getting access to the <em>batteries <span class="anchor" id="line-130"></span>included</em> in Python may be interesting. <span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span><pre>&gt; re = python.import("re")
&gt; pattern = re.compile("^Hel(lo) world!")
&gt; match = pattern.match("Hello world!")
&gt; =match.group(1)
lo</pre><span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span><p class="line874">Just like in the Python example, let's put a local object in <span class="anchor" id="line-140"></span>Python space. <span class="anchor" id="line-141"></span><span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span><span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><pre>&gt; d = {}
&gt; pg.d = d
&gt; python.execute("d['key'] = 'value'")
&gt; table.foreach(d, print)
key     value</pre><span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span><p class="line874">Again, let's grab back the reference from Python space. <span class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span><span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><span class="anchor" id="line-154"></span><pre>&gt; d2 = python.eval("d")
&gt; print(d == d2)
true</pre><span class="anchor" id="line-155"></span><span class="anchor" id="line-156"></span><p class="line874">Is the Lua interface available to Python? <span class="anchor" id="line-157"></span><span class="anchor" id="line-158"></span><span class="anchor" id="line-159"></span><span class="anchor" id="line-160"></span><pre>&gt; =python.eval("lua")
&lt;module 'lua' (built-in)&gt;</pre><span class="anchor" id="line-161"></span><span class="anchor" id="line-162"></span><p class="line874">Good. So let's do the nested trick in Lua as well. <span class="anchor" id="line-163"></span><span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span><span class="anchor" id="line-166"></span><span class="anchor" id="line-167"></span><span class="anchor" id="line-168"></span><span class="anchor" id="line-169"></span><span class="anchor" id="line-170"></span><pre>&gt; t = {}
&gt; =t
table: 0x80fbdb8
&gt; =python.eval("lua.eval('python.eval(\"lua.eval(\\'t\\')\")')")
table: 0x80fbdb8
&gt; </pre><span class="anchor" id="line-171"></span><span class="anchor" id="line-172"></span><p class="line874">It means that the Lua interpreter state inside the Python interpreter <span class="anchor" id="line-173"></span>is the same as the outside Lua interpreter state. Let's show that in <span class="anchor" id="line-174"></span>a more obvious way. <span class="anchor" id="line-175"></span><span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span><span class="anchor" id="line-178"></span><span class="anchor" id="line-179"></span><pre>&gt; python.execute("lg = lua.globals()")
&gt; =python.eval("lg.t")
table: 0x80fbdb8</pre><span class="anchor" id="line-180"></span><span class="anchor" id="line-181"></span><p class="line874">Now for the mixing example. <span class="anchor" id="line-182"></span><span class="anchor" id="line-183"></span><span class="anchor" id="line-184"></span><span class="anchor" id="line-185"></span><span class="anchor" id="line-186"></span><span class="anchor" id="line-187"></span><span class="anchor" id="line-188"></span><span class="anchor" id="line-189"></span><span class="anchor" id="line-190"></span><pre>&gt; function notthree(num)
&gt;&gt;   return (num ~= 3)
&gt;&gt; end
&gt; l = python.eval("[1, 2, 3, 4, 5]")
&gt; filter = python.eval("filter")
&gt; =filter(notthree, l)
[1, 2, 4, 5]</pre><span class="anchor" id="line-191"></span><span class="anchor" id="line-192"></span><span class="anchor" id="line-193"></span><p class="line867">
<h2 id="head-2b1074a43c064d4256fdb634f290e18dfd10d68c">Documentation</h2>
<span class="anchor" id="line-194"></span><span class="anchor" id="line-195"></span><span class="anchor" id="line-196"></span><p class="line867">
<h3 id="head-36c779da319d8576b21bbfcd186cab10c9ad8b80">Theory</h3>
<span class="anchor" id="line-197"></span><span class="anchor" id="line-198"></span><p class="line874">The bridging mechanism consists of creating the missing interpreter <span class="anchor" id="line-199"></span>state inside the host interpreter. That is, when you run the <span class="anchor" id="line-200"></span>bridging system inside Python, a Lua interpreter is created; when <span class="anchor" id="line-201"></span>you run the system inside Lua, a Python interpreter is created. <span class="anchor" id="line-202"></span><span class="anchor" id="line-203"></span><p class="line874">Once both interpreter states are available, these interpreters are <span class="anchor" id="line-204"></span>provided with the necessary tools to interact freely with each other. <span class="anchor" id="line-205"></span>The given tools offer not only the ability of executing statements <span class="anchor" id="line-206"></span>inside the alien interpreter, but also to acquire individual objects <span class="anchor" id="line-207"></span>and interact with them inside the native state. This magic is done <span class="anchor" id="line-208"></span>by two special object types, which act bridging native object access <span class="anchor" id="line-209"></span>to the alien interpreter state. <span class="anchor" id="line-210"></span><span class="anchor" id="line-211"></span><p class="line874">Almost every object which is passed between Python and Lua is <span class="anchor" id="line-212"></span>encapsulated in the language specific bridging object type. The <span class="anchor" id="line-213"></span>only types which are not encapsulated are strings and numbers, <span class="anchor" id="line-214"></span>which are converted to the native equivalent objects. <span class="anchor" id="line-215"></span><span class="anchor" id="line-216"></span><p class="line874">Besides that, the Lua side also has special treatment for <span class="anchor" id="line-217"></span>encapsulated Python functions and methods. The most obvious way <span class="anchor" id="line-218"></span>to implement calling of Python objects inside the Lua interpreter <span class="anchor" id="line-219"></span>is to implement a <tt class="backtick">__call</tt> function in the bridging object <span class="anchor" id="line-220"></span>metatable. Unfortunately this mechanism is not supported in <span class="anchor" id="line-221"></span>certain situations, since some places test if the object type is <span class="anchor" id="line-222"></span>a function, which is not the case of the bridging object. To <span class="anchor" id="line-223"></span>overwhelm these problems, Python functions and methods are <span class="anchor" id="line-224"></span>automatically converted to native Lua function closures, <span class="anchor" id="line-225"></span>becoming accessible in every Lua context. Callable object <span class="anchor" id="line-226"></span>instances which are not functions nor methods, on the other hand, <span class="anchor" id="line-227"></span>will still use the metatable mechanism. Luckily, they may also be <span class="anchor" id="line-228"></span>converted in a native function closure using the <em>asfunc()</em> <span class="anchor" id="line-229"></span>function, if necessary. <span class="anchor" id="line-230"></span><span class="anchor" id="line-231"></span><span class="anchor" id="line-232"></span><p class="line867">
<h3 id="head-67ce9242ddc55aba62a220e6db72d6d64dd18998">Attribute vs. Subscript object access</h3>
<span class="anchor" id="line-233"></span><span class="anchor" id="line-234"></span><p class="line874">Accessing an attribute or using the subscript operator in Lua give <span class="anchor" id="line-235"></span>access to the same information. This behavior is reflected in the <span class="anchor" id="line-236"></span>Python special object that encapsulates Lua objects, allowing Lua <span class="anchor" id="line-237"></span>tables to be accessed in a more comfortable way, and also giving <span class="anchor" id="line-238"></span>access to objects which use protected Python keywords (such as <span class="anchor" id="line-239"></span>the <em>print</em> function). For example: <span class="anchor" id="line-240"></span><span class="anchor" id="line-241"></span><span class="anchor" id="line-242"></span><span class="anchor" id="line-243"></span><span class="anchor" id="line-244"></span><span class="anchor" id="line-245"></span><span class="anchor" id="line-246"></span><pre>&gt;&gt;&gt; string = lua.eval("string")
&gt;&gt;&gt; string.lower
&lt;Lua function at 0x81c6bf8&gt;
&gt;&gt;&gt; string["lower"]
&lt;Lua function at 0x81c6bf8&gt;</pre><span class="anchor" id="line-247"></span><span class="anchor" id="line-248"></span><p class="line874">Using Python from the Lua side requires a little bit more attention, <span class="anchor" id="line-249"></span>since Python has a more strict syntax than Lua. The later makes no <span class="anchor" id="line-250"></span>distinction between attribute and subscript access, so we need some <span class="anchor" id="line-251"></span>way to know what kind of access is desired at a given moment. <span class="anchor" id="line-252"></span>This control is provided using two functions: <em>asindx()</em> and <span class="anchor" id="line-253"></span><em>asattr()</em>.  These functions receive a single Python object as <span class="anchor" id="line-254"></span>parameter, and return the same object with the given access <span class="anchor" id="line-255"></span>discipline. Notice that dictionaries and lists use the index <span class="anchor" id="line-256"></span>discipline by default, while other objects use the attribute discipline. <span class="anchor" id="line-257"></span>For example: <span class="anchor" id="line-258"></span><span class="anchor" id="line-259"></span><span class="anchor" id="line-260"></span><span class="anchor" id="line-261"></span><span class="anchor" id="line-262"></span><span class="anchor" id="line-263"></span><span class="anchor" id="line-264"></span><span class="anchor" id="line-265"></span><span class="anchor" id="line-266"></span><span class="anchor" id="line-267"></span><span class="anchor" id="line-268"></span><span class="anchor" id="line-269"></span><span class="anchor" id="line-270"></span><span class="anchor" id="line-271"></span><span class="anchor" id="line-272"></span><span class="anchor" id="line-273"></span><pre>&gt; dict = python.eval("{}")
&gt; =dict.keys
nil
&gt; dict.keys = 10
&gt; print(dict["keys"])
10
&gt; =dict
{'keys': 10}
&gt; =dict.keys = 10
n.asattr(dict)
&gt; =dict.keys
function: 0x80fa9b8
&gt; =dict.keys()
['keys']</pre><span class="anchor" id="line-274"></span><span class="anchor" id="line-275"></span><span class="anchor" id="line-276"></span><p class="line867">
<h3 id="head-754f1a340baa86da36ce0edb8ff8cb396d5be73f-2">Lua inside Python</h3>
<span class="anchor" id="line-277"></span><span class="anchor" id="line-278"></span><p class="line874">When executing Python as the host language, the Lua functionality <span class="anchor" id="line-279"></span>is accessed by importing the <em>lua</em> module. When Lua is the host <span class="anchor" id="line-280"></span>language, the <em>lua</em> module will already be available in the <span class="anchor" id="line-281"></span>global Python scope. <span class="anchor" id="line-282"></span><span class="anchor" id="line-283"></span><p class="line862">Below is a description of the functions available in the <em>lua</em> <span class="anchor" id="line-284"></span>module. <span class="anchor" id="line-285"></span><span class="anchor" id="line-286"></span><span class="anchor" id="line-287"></span><p class="line867">
<h4 id="head-d29353f5a33d5df95da35c5537c583b3ff2f4720">lua.execute(statement)</h4>
<span class="anchor" id="line-288"></span><p class="line874">This function will execute the given statement inside the Lua <span class="anchor" id="line-289"></span>interpreter state. <span class="anchor" id="line-290"></span><span class="anchor" id="line-291"></span><p class="line874">Examples: <span class="anchor" id="line-292"></span><span class="anchor" id="line-293"></span><span class="anchor" id="line-294"></span><pre>&gt;&gt;&gt; lua.execute("foo = 'bar'")</pre><span class="anchor" id="line-295"></span><span class="anchor" id="line-296"></span><span class="anchor" id="line-297"></span><p class="line867">
<h4 id="head-d934c4a2e4b687ab256d526d1a3a1a4c089a6e03">lua.eval(expression)</h4>
<span class="anchor" id="line-298"></span><span class="anchor" id="line-299"></span><p class="line874">This function will evaluate the given expression inside the Lua <span class="anchor" id="line-300"></span>interpreter state, and return the result. It may be used to <span class="anchor" id="line-301"></span>acquire any object from the Lua interpreter state. <span class="anchor" id="line-302"></span><span class="anchor" id="line-303"></span><p class="line874">Examples: <span class="anchor" id="line-304"></span><span class="anchor" id="line-305"></span><span class="anchor" id="line-306"></span><span class="anchor" id="line-307"></span><span class="anchor" id="line-308"></span><span class="anchor" id="line-309"></span><span class="anchor" id="line-310"></span><span class="anchor" id="line-311"></span><span class="anchor" id="line-312"></span><pre>&gt;&gt;&gt; lua.eval("'foo'..2")
'foo2'
&gt;&gt;&gt; lua.eval('string')
&lt;Lua table at 0x81c6ae8&gt;
&gt;&gt;&gt; string = lua.eval('string')
&gt;&gt;&gt; string.lower("Hello world!")
'hello world!'</pre><span class="anchor" id="line-313"></span><span class="anchor" id="line-314"></span><span class="anchor" id="line-315"></span><p class="line867">
<h4 id="head-ac48999ec279de50c49eee315e9df5d6bc2879ef">lua.globals()</h4>
<span class="anchor" id="line-316"></span><span class="anchor" id="line-317"></span><p class="line874">Return the Lua global scope from the interpreter state. <span class="anchor" id="line-318"></span><span class="anchor" id="line-319"></span><p class="line874">Examples: <span class="anchor" id="line-320"></span><span class="anchor" id="line-321"></span><span class="anchor" id="line-322"></span><span class="anchor" id="line-323"></span><span class="anchor" id="line-324"></span><span class="anchor" id="line-325"></span><span class="anchor" id="line-326"></span><span class="anchor" id="line-327"></span><span class="anchor" id="line-328"></span><span class="anchor" id="line-329"></span><span class="anchor" id="line-330"></span><pre>&gt;&gt;&gt; lg = lua.globals()
&gt;&gt;&gt; lg.string.lower("Hello world!")
'hello world!'
&gt;&gt;&gt; lg["string"].lower("Hello world!")
'hello world!'
&gt;&gt;&gt; lg["print"]
&lt;Lua function at 0x8154350&gt;
&gt;&gt;&gt; lg["print"]("Hello world!")
Hello world!</pre><span class="anchor" id="line-331"></span><span class="anchor" id="line-332"></span><span class="anchor" id="line-333"></span><p class="line867">
<h4 id="head-0264b4d4fce62e6c897a0947f34107d5484f67cc">lua.require(name)</h4>
<span class="anchor" id="line-334"></span><span class="anchor" id="line-335"></span><p class="line862">Executes the <em>require()</em> Lua function, importing the given <span class="anchor" id="line-336"></span>module. <span class="anchor" id="line-337"></span><span class="anchor" id="line-338"></span><p class="line874">Examples: <span class="anchor" id="line-339"></span><span class="anchor" id="line-340"></span><span class="anchor" id="line-341"></span><span class="anchor" id="line-342"></span><span class="anchor" id="line-343"></span><span class="anchor" id="line-344"></span><pre>&gt;&gt;&gt; lua.require("testmod")
True
&gt;&gt;&gt; lua.execute("func()")
I'm func in testmod!</pre><span class="anchor" id="line-345"></span><span class="anchor" id="line-346"></span><span class="anchor" id="line-347"></span><p class="line867">
<h3 id="head-f85d4ac1416491b93f8d7dbd118101ccb750b88f-2">Python inside Lua</h3>
<span class="anchor" id="line-348"></span><span class="anchor" id="line-349"></span><p class="line874">Unlike Python, Lua has no default path to its modules. Thus, the <span class="anchor" id="line-350"></span>default path of the real Lua module of <strong>Lunatic Python</strong> is <span class="anchor" id="line-351"></span>together with the Python module, and a <em>python.lua</em> stub is <span class="anchor" id="line-352"></span>provided. This stub must be placed in a path accessible by the Lua <span class="anchor" id="line-353"></span><em>require()</em> mechanism, and once imported it will locate the <span class="anchor" id="line-354"></span>real module and load it. <span class="anchor" id="line-355"></span><span class="anchor" id="line-356"></span><p class="line874">Unfortunately, there's a minor inconvenience for our purposes <span class="anchor" id="line-357"></span>regarding the Lua system which imports external shared objects. <span class="anchor" id="line-358"></span>The hardcoded behavior of the <em>loadlib()</em> function is to load <span class="anchor" id="line-359"></span>shared objects without exporting their symbols. This is usually <span class="anchor" id="line-360"></span>not a problem in the Lua world, but we're going a little beyond <span class="anchor" id="line-361"></span>their usual requirements here. We're loading the Python <span class="anchor" id="line-362"></span>interpreter as a shared object, and the Python interpreter may <span class="anchor" id="line-363"></span>load its own external modules which are compiled as shared <span class="anchor" id="line-364"></span>objects as well, and these will want to link back to the symbols <span class="anchor" id="line-365"></span>in the Python interpreter. Luckily, fixing this problem is easier <span class="anchor" id="line-366"></span>than explaining the problem. It's just a matter of replacing the <span class="anchor" id="line-367"></span>flag <em>RTLD_NOW</em> in the <em>loadlib.c</em> file of the Lua <span class="anchor" id="line-368"></span>distribution by the or'ed version <em>RTLD_NOW|RTLD_GLOBAL</em>. This <span class="anchor" id="line-369"></span>will avoid <em>"undefined symbol"</em> errors which could eventually <span class="anchor" id="line-370"></span>happen. <span class="anchor" id="line-371"></span><span class="anchor" id="line-372"></span><p class="line862">Below is a description of the functions available in the <em>python</em> <span class="anchor" id="line-373"></span>module. <span class="anchor" id="line-374"></span><span class="anchor" id="line-375"></span><span class="anchor" id="line-376"></span><p class="line867">
<h4 id="head-34c7190d9f029d0c2164b8c935ea07674ad2047d">python.execute(statement)</h4>
<span class="anchor" id="line-377"></span><span class="anchor" id="line-378"></span><p class="line874">This function will execute the given statement inside the Python <span class="anchor" id="line-379"></span>interpreter state. <span class="anchor" id="line-380"></span><span class="anchor" id="line-381"></span><p class="line874">Examples: <span class="anchor" id="line-382"></span><span class="anchor" id="line-383"></span><span class="anchor" id="line-384"></span><pre>&gt; python.execute("foo = 'bar'")</pre><span class="anchor" id="line-385"></span><span class="anchor" id="line-386"></span><span class="anchor" id="line-387"></span><p class="line867">
<h4 id="head-5653b4cdbfb4fad708dec62eedd259df979fc974">python.eval(expression)</h4>
<span class="anchor" id="line-388"></span><span class="anchor" id="line-389"></span><p class="line874">This function will evaluate the given expression inside the <span class="anchor" id="line-390"></span>Python interpreter state, and return the result. It may be used <span class="anchor" id="line-391"></span>to acquire any object from the Python interpreter state. <span class="anchor" id="line-392"></span><span class="anchor" id="line-393"></span><p class="line874">Examples: <span class="anchor" id="line-394"></span><span class="anchor" id="line-395"></span><span class="anchor" id="line-396"></span><span class="anchor" id="line-397"></span><span class="anchor" id="line-398"></span><span class="anchor" id="line-399"></span><span class="anchor" id="line-400"></span><span class="anchor" id="line-401"></span><pre>&gt; python.execute("import string")
&gt; =python.eval("string")
&lt;module 'string' from '/usr/lib/python2.3/string.pyc'&gt;
&gt; string = python.eval("string")
&gt; =string.lower("Hello world!")
hello world!</pre><span class="anchor" id="line-402"></span><span class="anchor" id="line-403"></span><span class="anchor" id="line-404"></span><p class="line867">
<h4 id="head-5d0bf28f2f609cc7c1b68a665e05ea67c5e73c38">python.globals()</h4>
<span class="anchor" id="line-405"></span><span class="anchor" id="line-406"></span><p class="line874">Return the Python global scope dictionary from the interpreter state. <span class="anchor" id="line-407"></span><span class="anchor" id="line-408"></span><p class="line874">Examples: <span class="anchor" id="line-409"></span><span class="anchor" id="line-410"></span><span class="anchor" id="line-411"></span><span class="anchor" id="line-412"></span><span class="anchor" id="line-413"></span><span class="anchor" id="line-414"></span><span class="anchor" id="line-415"></span><span class="anchor" id="line-416"></span><pre>&gt; python.execute("import string")
&gt; pg = python.globals()
&gt; =pg.string.lower("Hello world!")
hello world!
&gt; =pg["string"].lower("Hello world!")
hello world!</pre><span class="anchor" id="line-417"></span><span class="anchor" id="line-418"></span><span class="anchor" id="line-419"></span><p class="line867">
<h4 id="head-5efd9b09e3d66ddbdb8bd240165be18356872357">python.locals()</h4>
<span class="anchor" id="line-420"></span><span class="anchor" id="line-421"></span><p class="line874">Return the Python local scope dictionary from the interpreter state. <span class="anchor" id="line-422"></span><span class="anchor" id="line-423"></span><p class="line874">Examples: <span class="anchor" id="line-424"></span><span class="anchor" id="line-425"></span><span class="anchor" id="line-426"></span><span class="anchor" id="line-427"></span><span class="anchor" id="line-428"></span><span class="anchor" id="line-429"></span><span class="anchor" id="line-430"></span><span class="anchor" id="line-431"></span><span class="anchor" id="line-432"></span><span class="anchor" id="line-433"></span><pre>&gt; function luafunc()
&gt;&gt;   print(python.globals().var)
&gt;&gt;   print(python.locals().var)
&gt;&gt; end
&gt; python.execute("def func():\n var = 'value'\n lua.execute('luafunc()')")
&gt; python.execute("func()")
nil
value</pre><span class="anchor" id="line-434"></span><span class="anchor" id="line-435"></span><span class="anchor" id="line-436"></span><p class="line867">
<h4 id="head-7e8be30dff3be73fecf2de0e70c9f4ddba3049cf">python.builtins()</h4>
<span class="anchor" id="line-437"></span><span class="anchor" id="line-438"></span><p class="line874">Return the Python builtins module dictionary from the interpreter <span class="anchor" id="line-439"></span>state. <span class="anchor" id="line-440"></span><span class="anchor" id="line-441"></span><p class="line874">Examples: <span class="anchor" id="line-442"></span><span class="anchor" id="line-443"></span><span class="anchor" id="line-444"></span><span class="anchor" id="line-445"></span><span class="anchor" id="line-446"></span><pre>&gt; pb = python.builtins()
&gt; =pb.len("Hello world!")
12</pre><span class="anchor" id="line-447"></span><span class="anchor" id="line-448"></span><span class="anchor" id="line-449"></span><p class="line867">
<h4 id="head-ab520505e27022fc9bebe849aa257d31d2314696">python.import(name)</h4>
<span class="anchor" id="line-450"></span><span class="anchor" id="line-451"></span><p class="line874">Imports and returns the given Python module. <span class="anchor" id="line-452"></span><span class="anchor" id="line-453"></span><p class="line874">Examples: <span class="anchor" id="line-454"></span><span class="anchor" id="line-455"></span><span class="anchor" id="line-456"></span><span class="anchor" id="line-457"></span><span class="anchor" id="line-458"></span><pre>&gt; os = python.import("os")
&gt; =os.getcwd()
/home/niemeyer/src/lunatic-python</pre><span class="anchor" id="line-459"></span><span class="anchor" id="line-460"></span><span class="anchor" id="line-461"></span><p class="line867">
<h4 id="head-b593adbfa6879b3a8579b9d17d9446cf9a493a6b">python.asattr(pyobj)</h4>
<span class="anchor" id="line-462"></span><span class="anchor" id="line-463"></span><p class="line874">Return a copy of the given Python object with an attribute <span class="anchor" id="line-464"></span>access discipline. <span class="anchor" id="line-465"></span><span class="anchor" id="line-466"></span><p class="line874">Examples: <span class="anchor" id="line-467"></span><span class="anchor" id="line-468"></span><span class="anchor" id="line-469"></span><span class="anchor" id="line-470"></span><span class="anchor" id="line-471"></span><span class="anchor" id="line-472"></span><span class="anchor" id="line-473"></span><span class="anchor" id="line-474"></span><span class="anchor" id="line-475"></span><span class="anchor" id="line-476"></span><span class="anchor" id="line-477"></span><span class="anchor" id="line-478"></span><span class="anchor" id="line-479"></span><span class="anchor" id="line-480"></span><span class="anchor" id="line-481"></span><span class="anchor" id="line-482"></span><pre>&gt; dict = python.eval("{}")
&gt; =dict.keys
nil
&gt; dict.keys = 10
&gt; print(dict["keys"])
10
&gt; =dict
{'keys': 10}
&gt; =dict.keys = 10
n.asattr(dict)
&gt; =dict.keys
function: 0x80fa9b8
&gt; =dict.keys()
['keys']</pre><span class="anchor" id="line-483"></span><span class="anchor" id="line-484"></span><span class="anchor" id="line-485"></span><p class="line867">
<h4 id="head-20f9d5f61fe1e5789c62458c1d0619164d21beac">python.asindx(pyobj)</h4>
<span class="anchor" id="line-486"></span><span class="anchor" id="line-487"></span><p class="line874">Return a copy of the given Python object with an index <span class="anchor" id="line-488"></span>access discipline. <span class="anchor" id="line-489"></span><span class="anchor" id="line-490"></span><p class="line874">Examples: <span class="anchor" id="line-491"></span><span class="anchor" id="line-492"></span><span class="anchor" id="line-493"></span><span class="anchor" id="line-494"></span><span class="anchor" id="line-495"></span><span class="anchor" id="line-496"></span><span class="anchor" id="line-497"></span><span class="anchor" id="line-498"></span><span class="anchor" id="line-499"></span><span class="anchor" id="line-500"></span><span class="anchor" id="line-501"></span><span class="anchor" id="line-502"></span><pre>&gt; buffer = python.eval("buffer('foobar')")
&gt; =buffer[0]
stdin:1: unknown attribute in python object
stack traceback:
        [C]: ?
        stdin:1: in main chunk
        [C]: ?
&gt; buffer = python.asindx(buffer)
&gt; =buffer[0]
f</pre><span class="anchor" id="line-503"></span><span class="anchor" id="line-504"></span><span class="anchor" id="line-505"></span><p class="line867">
<h4 id="head-eeecbb742a965bf4acc375f09e99dd18917abe35">python.asfunc(pyobj)</h4>
<span class="anchor" id="line-506"></span><span class="anchor" id="line-507"></span><p class="line874">Return a copy of the given Python object enclosed in a <span class="anchor" id="line-508"></span>Lua function closure. This is useful to use Python callable <span class="anchor" id="line-509"></span>instances in places that require a Lua function. Python <span class="anchor" id="line-510"></span>methods and functions are automatically converted to <span class="anchor" id="line-511"></span>Lua functions, and don't require to be explicitly converted. <span class="anchor" id="line-512"></span><span class="anchor" id="line-513"></span><p class="line874">Examples: <span class="anchor" id="line-514"></span><span class="anchor" id="line-515"></span><span class="anchor" id="line-516"></span><span class="anchor" id="line-517"></span><span class="anchor" id="line-518"></span><span class="anchor" id="line-519"></span><span class="anchor" id="line-520"></span><span class="anchor" id="line-521"></span><span class="anchor" id="line-522"></span><span class="anchor" id="line-523"></span><span class="anchor" id="line-524"></span><span class="anchor" id="line-525"></span><span class="anchor" id="line-526"></span><span class="anchor" id="line-527"></span><span class="anchor" id="line-528"></span><span class="anchor" id="line-529"></span><pre>&gt; python.execute("class Join:\n def __call__(self, *args):\n  return '-'.join(args)")
&gt; join = python.eval("Join()")
&gt; =join
&lt;__main__.Join instance at 0x403a864c&gt;
&gt; =join('foo', 'bar')
foo-bar
&gt; =table.foreach({foo='bar'}, join)
stdin:1: bad argument #2 to `foreach' (function expected, got userdata)
stack traceback:
        [C]: in function `foreach'
        stdin:1: in main chunk
        [C]: ?
&gt; =table.foreach({foo='bar'}, python.asfunc(join))
foo-bar</pre><span class="anchor" id="line-530"></span><span class="anchor" id="line-531"></span><span class="anchor" id="line-532"></span><p class="line867">
<h2 id="head-19c09b3ae3308b28c62a9ba29b931cf33ec79584">License</h2>
<span class="anchor" id="line-533"></span><span class="anchor" id="line-534"></span><p class="line867"><strong>Lunatic Python</strong> is available under the LGPL license. <span class="anchor" id="line-535"></span><span class="anchor" id="line-536"></span><span class="anchor" id="line-537"></span><p class="line867">
<h2 id="head-ab5161ec0e130f46c66e3a207a80e8e4893b3b21">Download</h2>
<span class="anchor" id="line-538"></span><span class="anchor" id="line-539"></span><p class="line874">Available files: <span class="anchor" id="line-540"></span><span class="anchor" id="line-541"></span><ul><li><p class="line891"><a class="attachment" href="/download/lunatic-python/lunatic-python-1.0.tar.bz2" title="attachment:lunatic-python-1.0.tar.bz2">lunatic-python-1.0.tar.bz2</a> <span class="anchor" id="line-542"></span><span class="anchor" id="line-543"></span><span class="anchor" id="line-544"></span></li></ul><p class="line867">
<h2 id="head-d0597456187b5ea4006f9427346633f765432975">Author</h2>
<span class="anchor" id="line-545"></span><span class="anchor" id="line-546"></span><p class="line862">Gustavo Niemeyer &lt;<a class="mailto" href="mailto:gustavo@niemeyer.net">gustavo@niemeyer.net</a>&gt; <span class="anchor" id="line-547"></span><span class="anchor" id="line-548"></span><span class="anchor" id="line-549"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-550"></span><a href="/CategoryProject">CategoryProject</a> <span class="anchor" id="line-551"></span><span class="anchor" id="bottom"></span></div><p id="pageinfo" class="info" lang="en" dir="ltr">lunatic-python  (last edited 2008-03-03 03:03:18 by <span title="GustavoNiemeyer @ 200-103-245-169.ctame705.dsl.brasiltelecom.net.br[200.103.245.169]"><a class="nonexistent" href="/GustavoNiemeyer" title="GustavoNiemeyer @ 200-103-245-169.ctame705.dsl.brasiltelecom.net.br[200.103.245.169]">GustavoNiemeyer</a></span>)</p>

<div id="pagebottom"></div>
</div>


<div id="footer">
<ul id="credits">
<li><a href="http://moinmo.in/" title="This site uses the MoinMoin Wiki software.">MoinMoin Powered</a></li><li><a href="http://moinmo.in/Python" title="MoinMoin is written in Python.">Python Powered</a></li><li><a href="http://moinmo.in/GPL" title="MoinMoin is GPL licensed.">GPL licensed</a></li><li><a href="http://validator.w3.org/check?uri=referer" title="Click here to validate this page.">Valid HTML 4.01</a></li>
</ul>


</div>


<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-3731229-3");
pageTracker._initData();
pageTracker._trackPageview();
</script>
</body>
</html>

